library("QuasiSeq")
# source("P:\\stevescode\\QuasiSeq_1.0-2\\QuasiSeq\\R\\QL.fit.R")
# source("P:\\stevescode\\QuasiSeq_1.0-2\\QuasiSeq\\R\\NBDev.R")
# source("P:\\stevescode\\QuasiSeq_1.0-2\\QuasiSeq\\R\\PoisDev.R")
# source("P:\\stevescode\\QuasiSeq_1.0-2\\QuasiSeq\\R\\QL.results.R")

counts <- structure(c(133, 13, 427, 0, 43, 364, 844, 0, 40, 0, 26, 1, 53, 
                      10, 90, 317, 1, 31, 2, 2, 95, 2, 1, 682, 6, 93, 0, 17, 1, 9, 
                      51, 1, 94, 243, 1552, 916, 0, 4, 1, 849, 4, 838, 0, 29, 499, 
                      173, 1994, 27, 92, 3, 367, 152, 65, 359, 0, 69, 26, 14, 55, 816, 
                      64, 19, 472, 979, 1138, 279, 1, 90, 1, 1456, 4, 176, 70, 0, 1210, 
                      76, 2, 4, 11, 154, 4, 28, 7105, 122, 388, 2, 141, 83, 69, 4004, 
                      3, 2, 141, 369, 4, 1503, 28, 29, 10, 18, 118, 26, 863, 2, 100, 
                      356, 179, 6, 115, 2, 10, 1, 161, 7, 90, 173, 3, 4, 3, 0, 74, 
                      0, 2, 644, 19, 174, 0, 50, 1, 7, 105, 0, 363, 111, 689, 463, 
                      0, 2, 4, 766, 2, 285, 1, 51, 272, 586, 372, 1, 52, 9, 97, 145, 
                      33, 51, 0, 266, 116, 37, 117, 912, 385, 71, 706, 1368, 575, 129, 
                      0, 217, 2, 186, 11, 239, 59, 8, 588, 261, 14, 7, 23, 571, 1, 
                      12, 2156, 301, 1254, 1, 122, 60, 164, 1825, 90, 0, 73, 541, 3, 
                      474, 3, 44, 5, 21, 14, 44, 216, 2, 79, 102, 115, 6, 1171, 1, 
                      20, 2, 297, 1, 9, 157, 3, 33, 3, 0, 17, 5, 3, 5864, 48, 355, 
                      4, 84, 1, 1, 3, 1, 1817, 65, 699, 69, 0, 8, 13, 2284, 28, 1200, 
                      2, 165, 1086, 811, 181, 1, 15, 0, 89, 47, 6, 98, 9, 44, 13, 8, 
                      52, 115, 133, 92, 164, 503, 1782, 31, 0, 235, 0, 431, 41, 77, 
                      31, 4, 394, 385, 6, 19, 4, 1063, 3, 16, 1400, 1807, 1833, 1, 
                      82, 8, 422, 320, 6, 7, 268, 231, 4, 270, 89, 246, 81, 30, 40, 
                      23, 118, 0, 59, 331, 106, 7, 250, 16, 7, 0, 334, 8, 68, 51, 14, 
                      129, 2, 1, 31, 9, 10, 310, 27, 309, 2, 114, 1, 2, 59, 1, 735, 
                      61, 184, 183, 4, 0, 18, 2559, 35, 570, 3, 362, 2456, 427, 60, 
                      3, 37, 0, 47, 38, 18, 71, 7, 157, 24, 14, 20, 35, 345, 64, 99, 
                      1275, 1590, 25, 1, 224, 0, 148, 23, 25, 47, 12, 344, 882, 30, 
                      64, 5, 6129, 8, 47, 2079, 2210, 1318, 5, 89, 68, 1406, 268, 184, 
                      2, 411, 286, 3, 197, 51, 169, 36, 40, 34, 3, 430, 2, 198, 72, 
                      385, 2, 203, 2, 2, 0, 418, 8, 62, 225, 9, 117, 2, 1, 57, 3, 15, 
                      2036, 12, 116, 11, 167, 0, 1, 94, 8, 1111, 94, 817, 88, 0, 9, 
                      2, 3180, 8, 519, 3, 125, 1358, 347, 1140, 3, 29, 3, 254, 18, 
                      102, 31, 4, 160, 24, 14, 23, 82, 211, 129, 82, 994, 5211, 94, 
                      4, 106, 1, 332, 4, 204, 84, 7, 274, 1196, 13, 41, 20, 907, 11, 
                      32, 4108, 1478, 2788, 0, 235, 20, 301, 521, 41, 5, 209, 169, 
                      1, 437, 46, 25, 19, 111, 137, 9, 4732, 2, 7, 363, 790, 11, 178, 
                      3, 29, 2, 254, 8, 182, 102, 0, 17, 2, 6, 46, 3, 0, 368, 16, 53, 
                      2, 8, 3, 2, 87, 3, 336, 258, 1192, 176, 1, 3, 1, 1140, 0, 365, 
                      10, 9, 294, 789, 456, 0, 87, 0, 131, 122, 18, 54, 0, 78, 56, 
                      42, 224, 500, 278, 71, 422, 1425, 1051, 171, 0, 165, 1, 211, 
                      4, 84, 48, 2, 1252, 183, 39, 15, 7, 323, 11, 35, 2832, 466, 1161, 
                      0, 324, 7, 78, 1225, 25, 17, 96, 556, 1, 1675, 16, 81, 21, 23, 
                      129, 18, 356, 0, 106, 75, 178, 5, 523, 2, 4, 0, 249, 1, 36, 16, 
                      7, 73, 18, 1, 89, 5, 0, 1486, 9, 291, 9, 28, 3, 2, 99, 1, 79, 
                      161, 424, 186, 8, 2, 9, 1300, 21, 1825, 2, 137, 725, 697, 468, 
                      3, 61, 11, 45, 72, 12, 30, 1, 337, 16, 29, 19, 206, 91, 27, 464, 
                      1033, 2195, 41, 0, 564, 2, 136, 88, 60, 15, 16, 325, 249, 29, 
                      25, 4, 1112, 0, 18, 1694, 1886, 483, 0, 73, 18, 264, 702, 62, 
                      8, 221, 318, 9, 622, 50, 123, 13, 49, 21, 30, 256, 4, 21, 233, 
                      579, 0, 278, 6, 10, 0, 398, 2, 57, 254, 14, 181, 18, 2, 18, 15, 
                      18, 1933, 24, 382, 0, 50, 4, 0, 59, 5, 603, 231, 382, 112, 2, 
                      10, 20, 4165, 12, 506, 5, 65, 1334, 114, 924, 0, 81, 6, 8, 44, 
                      57, 70, 2, 185, 16, 17, 42, 191, 161, 70, 108, 955, 2710, 61, 
                      3, 257, 4, 540, 26, 22, 62, 9, 184, 349, 27, 44, 2, 1606, 3, 
                      42, 2177, 458, 2506, 0, 215, 18, 73, 305, 111, 2, 246, 506, 11, 
                      294, 97, 54, 17, 42, 56, 27, 835, 3, 22, 377, 663, 2, 124, 3, 
                      11, 0, 280, 1, 66, 60, 2, 89, 4, 12, 14, 8, 5, 997, 20, 590, 
                      10, 72, 0, 8, 104, 8, 385, 120, 855, 373, 0, 0, 14, 1937, 51, 
                      951, 7, 141, 1308, 244, 664, 3, 33, 6, 132, 149, 11, 23, 0, 47, 
                      83, 19, 98, 159, 76, 19, 170, 1610, 1534, 60, 0, 325, 0, 333, 
                      6, 104, 107, 18, 572, 96, 25, 32, 14, 721, 0, 60, 5360, 501, 
                      945, 0, 94, 59, 150, 774, 72, 5, 447, 312, 20, 600, 19, 174, 
                      13, 8, 29, 42, 1053, 3, 31, 141, 703, 16, 232, 2, 9, 0, 328, 
                      12, 45, 220, 5, 55, 1, 0, 50, 6, 1, 797, 4, 249, 4, 27, 0, 3, 
                      65, 2, 310, 166, 1504, 272, 0, 1, 0, 1115, 32, 806, 2, 64, 863, 
                      341, 1071, 5, 30, 6, 46, 188, 40, 45, 0, 25, 40, 31, 70, 402, 
                      554, 44, 406, 317, 1191, 159, 1, 174, 0, 308, 13, 71, 75, 5, 
                      257, 148, 10, 2, 34, 242, 2, 97, 4533, 96, 478, 1, 156, 64, 175, 
                      1003, 12, 1, 145, 305, 12, 1347, 44, 130, 9, 11, 160, 42, 1909, 
                      12, 230, 634, 4184, 15, 176, 0, 8, 4, 298, 51, 464, 406, 23, 
                      46, 7, 4, 81, 6, 0, 407, 15, 215, 7, 55, 4, 2, 131, 0, 230, 132, 
                      531, 339, 5, 3, 4, 1948, 13, 368, 0, 34, 571, 525, 544, 0, 33, 
                      10, 270, 10, 20, 24, 0, 68, 36, 31, 47, 85, 301, 9, 312, 1220, 
                      1691, 82, 4, 54, 3, 420, 3, 106, 116, 0, 711, 68, 7, 18, 4, 970, 
                      0, 26, 8722, 615, 1519, 0, 131, 116, 111, 724, 22, 1, 222, 757, 
                      0, 321, 13, 31, 9, 22, 210, 127, 832, 4, 685, 78, 812, 11, 283, 
                      10, 9, 0, 549, 213, 41, 115, 14, 104, 5, 0, 18, 4, 3, 844, 57, 
                      467, 0, 43, 0, 4, 74, 2, 1448, 72, 563, 239, 2, 11, 0, 1871, 
                      1, 1199, 0, 13, 389, 263, 289, 9, 18, 9, 135, 41, 64, 24, 3, 
                      193, 9, 3, 62, 144, 85, 64, 171, 3079, 2336, 89, 3, 203, 4, 141, 
                      17, 11, 96, 1, 148, 859, 18, 4, 10, 444, 3, 23, 2212, 593, 560, 
                      3, 42, 25, 318, 341, 39, 1, 140, 368, 11, 415, 86, 293, 25, 79, 
                      234, 43, 609, 4, 131, 557, 5334, 19, 180, 5, 6, 0, 489, 80, 110, 
                      61, 43, 157, 14, 1, 17, 1, 0, 1660, 4, 247, 4, 5, 5, 7, 16, 6, 
                      847, 192, 896, 57, 1, 2, 0, 407, 5, 957, 2, 45, 1223, 419, 316, 
                      0, 11, 14, 133, 64, 21, 78, 2, 189, 23, 14, 57, 245, 199, 49, 
                      228, 1521, 1858, 17, 0, 305, 2, 325, 19, 320, 111, 9, 85, 485, 
                      9, 50, 21, 100, 9, 50, 4056, 887, 661, 6, 18, 24, 264, 991, 66, 
                      10, 79, 313, 17, 88, 54, 50, 86, 83, 209, 46, 844, 10, 398, 179, 
                      5409, 21, 781, 0, 20, 0, 369, 208, 89, 162, 12, 95, 10, 12, 47, 
                      15, 3, 335, 24, 48, 3, 48, 4, 4, 164, 3, 189, 392, 167, 233, 
                      3, 7, 0, 611, 0, 874, 0, 17, 1073, 363, 588, 5, 24, 4, 199, 37, 
                      36, 48, 0, 63, 116, 7, 23, 178, 300, 115, 351, 1333, 1437, 61, 
                      0, 118, 1, 931, 58, 98, 23, 2, 1554, 661, 32, 11, 19, 158, 1, 
                      18, 3578, 195, 924, 0, 519, 8, 40, 839, 65, 0, 59, 444, 3, 406, 
                      81, 59, 25, 2, 139, 51, 1395, 2, 146, 498, 2966, 20, 501, 7, 
                      28, 5, 438, 81, 69, 93, 7, 27, 1, 5, 108, 5, 0, 323, 32, 139, 
                      5, 42, 0, 5, 101, 0, 350, 564, 2244, 250, 0, 1, 4, 1059, 11, 
                      508, 0, 39, 184, 134, 296, 0, 83, 2, 158, 124, 50, 56, 2, 398, 
                      14, 5, 135, 46, 697, 16, 544, 1661, 1864, 268, 2, 127, 3, 430, 
                      7, 58, 44, 4, 697, 198, 8, 3, 26, 283, 6, 120, 9937, 340, 339, 
                      6, 81, 30, 82, 268, 25, 1, 53, 602, 18, 2970, 17, 30, 4, 15, 
                      86, 41, 142, 8, 67, 254, 2697, 11, 896, 0, 0, 2, 1050, 201, 76, 
                      83, 3, 298, 13, 2, 5, 5, 1, 1182, 51, 319, 0, 61, 0, 11, 21, 
                      0, 1185, 15, 318, 139, 0, 10, 6, 1724, 3, 394, 2, 196, 1124, 
                      264, 587, 20, 16, 4, 103, 22, 15, 89, 2, 106, 2, 2, 55, 118, 
                      295, 47, 95, 3661, 3709, 1, 3, 318, 0, 178, 46, 133, 82, 8, 116, 
                      810, 5, 73, 9, 492, 18, 16, 1811, 1320, 1592, 2, 158, 22, 410, 
                      182, 44, 7, 530, 170, 2, 82, 60, 194, 41, 45, 107, 17, 810, 18, 
                      53, 160, 2216, 1, 616, 0, 8, 3, 355, 155, 260, 123, 20, 28, 2, 
                      5, 18, 11, 4, 1042, 20, 199, 0, 42, 2, 8, 69, 4, 244, 190, 1287, 
                      67, 0, 0, 13, 2556, 10, 1048, 2, 55, 1254, 304, 169, 1, 48, 2, 
                      54, 11, 22, 38, 0, 237, 70, 11, 34, 157, 204, 53, 254, 727, 4136, 
                      134, 0, 245, 0, 1493, 22, 187, 44, 4, 287, 517, 34, 30, 5, 1012, 
                      0, 107, 1534, 267, 1210, 2, 206, 73, 61, 636, 2, 9, 123, 201, 
                      1, 931, 13, 32, 18, 6, 24, 13, 471, 2, 55, 142, 994, 34, 515, 
                      23, 9, 1, 232, 30, 134, 383, 36, 407, 8, 0, 59, 0, 4, 3135, 21, 
                      180, 2, 32, 2, 4, 108, 5, 567, 64, 65, 85, 1, 3, 13, 424, 16, 
                      1978, 2, 143, 935, 1032, 265, 0, 37, 1, 17, 30, 28, 95, 0, 68, 
                      24, 10, 50, 66, 286, 49, 182, 4160, 1585, 69, 1, 475, 6, 403, 
                      38, 61, 158, 16, 231, 123, 23, 20, 2, 928, 18, 98, 1800, 157, 
                      455, 5, 349, 16, 407, 327, 72, 5, 196, 197, 3, 405, 37, 133, 
                      26, 70, 152, 81, 403, 8, 44, 441, 3477, 7, 944, 3, 14, 3, 1080, 
                      289, 63, 252, 23, 94, 8, 4, 8, 13, 9, 2057, 93, 419, 1, 87, 0, 
                      6, 95, 1, 478, 58, 185, 68, 1, 2, 7, 2472, 6, 707, 2, 115, 2591, 
                      348, 1066, 1, 61, 2, 40, 23, 24, 22, 2, 339, 37, 19, 30, 108, 
                      200, 68, 231, 1544, 5985, 92, 0, 490, 7, 132, 22, 92, 67, 0, 
                      367, 391, 71, 51, 8, 2025, 27, 32, 3563, 852, 645, 1, 239, 20, 
                      439, 274, 21, 4, 63, 377, 1, 831, 128, 406, 75, 137, 50, 4, 448, 
                      0, 134, 242, 366, 10, 710, 7, 4, 1, 347, 257, 54, 234, 10, 59, 
                      1, 8, 34, 12, 1, 1363, 24, 54, 1, 143, 2, 0, 58, 0, 222, 23, 
                      781, 207, 4, 0, 5, 2272, 14, 544, 1, 133, 1739, 168, 1055, 0, 
                      15, 4, 111, 140, 43, 48, 1, 238, 7, 12, 46, 185, 341, 47, 378, 
                      2310, 1033, 40, 0, 445, 1, 436, 22, 32, 136, 0, 505, 352, 25, 
                      8, 13, 879, 5, 21, 1454, 516, 659, 1, 425, 24, 522, 431, 14, 
                      1, 210, 130, 6, 355, 86, 85, 38, 54), .Dim = c(100L, 20L))



design.list <- vector("list",2)
design.list[[1]] <- rep(1:2, each = 10)
design.list[[2]] <- rep(1, ncol(counts))
#size <- apply(counts, 2, quantile, .75)
size <- apply(counts, 2, sum)

fit <- QL.fit(counts, design.list, 
              log.offset = log(size),
              Model = "NegBin",
              print.progress=FALSE)
warnings()
traceback()